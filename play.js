(()=>{var et=Object.create,z=Object.defineProperty,tt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty,it=Object.getOwnPropertyNames,nt=Object.getOwnPropertyDescriptor;var st=e=>z(e,"__esModule",{value:!0});var C=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports);var at=(e,t,i)=>{if(st(e),t&&typeof t=="object"||typeof t=="function")for(let n of it(t))!rt.call(e,n)&&n!=="default"&&z(e,n,{get:()=>t[n],enumerable:!(i=nt(t,n))||i.enumerable});return e},V=e=>e&&e.__esModule?e:at(z(e!=null?et(tt(e)):{},"default",{value:e,enumerable:!0}),e);var he=C((Gt,ce)=>{"use strict";ce.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)});var me=C((Mt,le)=>{"use strict";var fe="%[a-f0-9]{2}",ue=new RegExp(fe,"gi"),de=new RegExp("("+fe+")+","gi");function W(e,t){try{return decodeURIComponent(e.join(""))}catch(l){}if(e.length===1)return e;t=t||1;var i=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],W(i),W(n))}function ot(e){try{return decodeURIComponent(e)}catch(n){for(var t=e.match(ue),i=1;i<t.length;i++)e=W(t,i).join(""),t=e.match(ue);return e}}function ct(e){for(var t={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},i=de.exec(e);i;){try{t[i[0]]=decodeURIComponent(i[0])}catch(r){var n=ot(i[0]);n!==i[0]&&(t[i[0]]=n)}i=de.exec(e)}t["%C2"]="\uFFFD";for(var l=Object.keys(t),d=0;d<l.length;d++){var s=l[d];e=e.replace(new RegExp(s,"g"),t[s])}return e}le.exports=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return ct(e)}}});var ge=C((Tt,ye)=>{"use strict";ye.exports=(e,t)=>{if(!(typeof e=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t==="")return[e];let i=e.indexOf(t);return i===-1?[e]:[e.slice(0,i),e.slice(i+t.length)]}});var Ee=C(R=>{"use strict";var ht=he(),lt=me(),pe=ge(),ft=e=>e==null;function ut(e){switch(e.arrayFormat){case"index":return t=>(i,n)=>{let l=i.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?i:n===null?[...i,[B(t,e),"[",l,"]"].join("")]:[...i,[B(t,e),"[",B(l,e),"]=",B(n,e)].join("")]};case"bracket":return t=>(i,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?i:n===null?[...i,[B(t,e),"[]"].join("")]:[...i,[B(t,e),"[]=",B(n,e)].join("")];case"comma":case"separator":return t=>(i,n)=>n==null||n.length===0?i:i.length===0?[[B(t,e),"=",B(n,e)].join("")]:[[i,B(n,e)].join(e.arrayFormatSeparator)];default:return t=>(i,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?i:n===null?[...i,B(t,e)]:[...i,[B(t,e),"=",B(n,e)].join("")]}}function dt(e){let t;switch(e.arrayFormat){case"index":return(i,n,l)=>{if(t=/\[(\d*)\]$/.exec(i),i=i.replace(/\[\d*\]$/,""),!t){l[i]=n;return}l[i]===void 0&&(l[i]={}),l[i][t[1]]=n};case"bracket":return(i,n,l)=>{if(t=/(\[\])$/.exec(i),i=i.replace(/\[\]$/,""),!t){l[i]=n;return}if(l[i]===void 0){l[i]=[n];return}l[i]=[].concat(l[i],n)};case"comma":case"separator":return(i,n,l)=>{let d=typeof n=="string"&&n.includes(e.arrayFormatSeparator),s=typeof n=="string"&&!d&&k(n,e).includes(e.arrayFormatSeparator);n=s?k(n,e):n;let r=d||s?n.split(e.arrayFormatSeparator).map(c=>k(c,e)):n===null?n:k(n,e);l[i]=r};default:return(i,n,l)=>{if(l[i]===void 0){l[i]=n;return}l[i]=[].concat(l[i],n)}}}function xe(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function B(e,t){return t.encode?t.strict?ht(e):encodeURIComponent(e):e}function k(e,t){return t.decode?lt(e):e}function we(e){return Array.isArray(e)?e.sort():typeof e=="object"?we(Object.keys(e)).sort((t,i)=>Number(t)-Number(i)).map(t=>e[t]):e}function Se(e){let t=e.indexOf("#");return t!==-1&&(e=e.slice(0,t)),e}function mt(e){let t="",i=e.indexOf("#");return i!==-1&&(t=e.slice(i)),t}function be(e){e=Se(e);let t=e.indexOf("?");return t===-1?"":e.slice(t+1)}function ve(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):t.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function Ie(e,t){t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t),xe(t.arrayFormatSeparator);let i=dt(t),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let l of e.split("&")){let[d,s]=pe(t.decode?l.replace(/\+/g," "):l,"=");s=s===void 0?null:["comma","separator"].includes(t.arrayFormat)?s:k(s,t),i(k(d,t),s,n)}for(let l of Object.keys(n)){let d=n[l];if(typeof d=="object"&&d!==null)for(let s of Object.keys(d))d[s]=ve(d[s],t);else n[l]=ve(d,t)}return t.sort===!1?n:(t.sort===!0?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce((l,d)=>{let s=n[d];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?l[d]=we(s):l[d]=s,l},Object.create(null))}R.extract=be;R.parse=Ie;R.stringify=(e,t)=>{if(!e)return"";t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t),xe(t.arrayFormatSeparator);let i=s=>t.skipNull&&ft(e[s])||t.skipEmptyString&&e[s]==="",n=ut(t),l={};for(let s of Object.keys(e))i(s)||(l[s]=e[s]);let d=Object.keys(l);return t.sort!==!1&&d.sort(t.sort),d.map(s=>{let r=e[s];return r===void 0?"":r===null?B(s,t):Array.isArray(r)?r.reduce(n(s),[]).join("&"):B(s,t)+"="+B(r,t)}).filter(s=>s.length>0).join("&")};R.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);let[i,n]=pe(e,"#");return Object.assign({url:i.split("?")[0]||"",query:Ie(be(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:k(n,t)}:{})};R.stringifyUrl=(e,t)=>{t=Object.assign({encode:!0,strict:!0},t);let i=Se(e.url).split("?")[0]||"",n=R.extract(e.url),l=R.parse(n,{sort:!1}),d=Object.assign(l,e.query),s=R.stringify(d,t);s&&(s=`?${s}`);let r=mt(e.url);return e.fragmentIdentifier&&(r=`#${B(e.fragmentIdentifier,t)}`),`${i}${s}${r}`}});var Oe=C((Fe,Y)=>{(function(e,t,i){function n(r){var c=this,h=s();c.next=function(){var a=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=a-(c.c=a|0)},c.c=1,c.s0=h(" "),c.s1=h(" "),c.s2=h(" "),c.s0-=h(r),c.s0<0&&(c.s0+=1),c.s1-=h(r),c.s1<0&&(c.s1+=1),c.s2-=h(r),c.s2<0&&(c.s2+=1),h=null}function l(r,c){return c.c=r.c,c.s0=r.s0,c.s1=r.s1,c.s2=r.s2,c}function d(r,c){var h=new n(r),a=c&&c.state,o=h.next;return o.int32=function(){return h.next()*4294967296|0},o.double=function(){return o()+(o()*2097152|0)*11102230246251565e-32},o.quick=o,a&&(typeof a=="object"&&l(a,h),o.state=function(){return l(h,{})}),o}function s(){var r=4022871197,c=function(h){h=String(h);for(var a=0;a<h.length;a++){r+=h.charCodeAt(a);var o=.02519603282416938*r;r=o>>>0,o-=r,o*=r,r=o>>>0,o-=r,r+=o*4294967296}return(r>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=d:i&&i.amd?i(function(){return d}):this.alea=d})(Fe,typeof Y=="object"&&Y,typeof define=="function"&&define)});var Ne=C((Pe,J)=>{(function(e,t,i){function n(s){var r=this,c="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var a=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^a^a>>>8},s===(s|0)?r.x=s:c+=s;for(var h=0;h<c.length+64;h++)r.x^=c.charCodeAt(h)|0,r.next()}function l(s,r){return r.x=s.x,r.y=s.y,r.z=s.z,r.w=s.w,r}function d(s,r){var c=new n(s),h=r&&r.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var o=c.next()>>>11,f=(c.next()>>>0)/4294967296,y=(o+f)/(1<<21);while(y===0);return y},a.int32=c.next,a.quick=a,h&&(typeof h=="object"&&l(h,c),a.state=function(){return l(c,{})}),a}t&&t.exports?t.exports=d:i&&i.amd?i(function(){return d}):this.xor128=d})(Pe,typeof J=="object"&&J,typeof define=="function"&&define)});var _e=C((Be,K)=>{(function(e,t,i){function n(s){var r=this,c="";r.next=function(){var a=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(a^a<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,s===(s|0)?r.x=s:c+=s;for(var h=0;h<c.length+64;h++)r.x^=c.charCodeAt(h)|0,h==c.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function l(s,r){return r.x=s.x,r.y=s.y,r.z=s.z,r.w=s.w,r.v=s.v,r.d=s.d,r}function d(s,r){var c=new n(s),h=r&&r.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var o=c.next()>>>11,f=(c.next()>>>0)/4294967296,y=(o+f)/(1<<21);while(y===0);return y},a.int32=c.next,a.quick=a,h&&(typeof h=="object"&&l(h,c),a.state=function(){return l(c,{})}),a}t&&t.exports?t.exports=d:i&&i.amd?i(function(){return d}):this.xorwow=d})(Be,typeof K=="object"&&K,typeof define=="function"&&define)});var je=C((Ce,Q)=>{(function(e,t,i){function n(s){var r=this;r.next=function(){var h=r.x,a=r.i,o,f,y;return o=h[a],o^=o>>>7,f=o^o<<24,o=h[a+1&7],f^=o^o>>>10,o=h[a+3&7],f^=o^o>>>3,o=h[a+4&7],f^=o^o<<7,o=h[a+7&7],o=o^o<<13,f^=o^o<<9,h[a]=f,r.i=a+1&7,f};function c(h,a){var o,f,y=[];if(a===(a|0))f=y[0]=a;else for(a=""+a,o=0;o<a.length;++o)y[o&7]=y[o&7]<<15^a.charCodeAt(o)+y[o+1&7]<<13;for(;y.length<8;)y.push(0);for(o=0;o<8&&y[o]===0;++o);for(o==8?f=y[7]=-1:f=y[o],h.x=y,h.i=0,o=256;o>0;--o)h.next()}c(r,s)}function l(s,r){return r.x=s.x.slice(),r.i=s.i,r}function d(s,r){s==null&&(s=+new Date);var c=new n(s),h=r&&r.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var o=c.next()>>>11,f=(c.next()>>>0)/4294967296,y=(o+f)/(1<<21);while(y===0);return y},a.int32=c.next,a.quick=a,h&&(h.x&&l(h,c),a.state=function(){return l(c,{})}),a}t&&t.exports?t.exports=d:i&&i.amd?i(function(){return d}):this.xorshift7=d})(Ce,typeof Q=="object"&&Q,typeof define=="function"&&define)});var Ge=C((Re,Z)=>{(function(e,t,i){function n(s){var r=this;r.next=function(){var h=r.w,a=r.X,o=r.i,f,y;return r.w=h=h+1640531527|0,y=a[o+34&127],f=a[o=o+1&127],y^=y<<13,f^=f<<17,y^=y>>>15,f^=f>>>12,y=a[o]=y^f,r.i=o,y+(h^h>>>16)|0};function c(h,a){var o,f,y,I,N,E=[],_=128;for(a===(a|0)?(f=a,a=null):(a=a+"\0",f=0,_=Math.max(_,a.length)),y=0,I=-32;I<_;++I)a&&(f^=a.charCodeAt((I+32)%a.length)),I===0&&(N=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,I>=0&&(N=N+1640531527|0,o=E[I&127]^=f+N,y=o==0?y+1:0);for(y>=128&&(E[(a&&a.length||0)&127]=-1),y=127,I=4*128;I>0;--I)f=E[y+34&127],o=E[y=y+1&127],f^=f<<13,o^=o<<17,f^=f>>>15,o^=o>>>12,E[y]=f^o;h.w=N,h.X=E,h.i=y}c(r,s)}function l(s,r){return r.i=s.i,r.w=s.w,r.X=s.X.slice(),r}function d(s,r){s==null&&(s=+new Date);var c=new n(s),h=r&&r.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var o=c.next()>>>11,f=(c.next()>>>0)/4294967296,y=(o+f)/(1<<21);while(y===0);return y},a.int32=c.next,a.quick=a,h&&(h.X&&l(h,c),a.state=function(){return l(c,{})}),a}t&&t.exports?t.exports=d:i&&i.amd?i(function(){return d}):this.xor4096=d})(Re,typeof Z=="object"&&Z,typeof define=="function"&&define)});var Te=C((Me,ee)=>{(function(e,t,i){function n(s){var r=this,c="";r.next=function(){var a=r.b,o=r.c,f=r.d,y=r.a;return a=a<<25^a>>>7^o,o=o-f|0,f=f<<24^f>>>8^y,y=y-a|0,r.b=a=a<<20^a>>>12^o,r.c=o=o-f|0,r.d=f<<16^o>>>16^y,r.a=y-a|0},r.a=0,r.b=0,r.c=2654435769|0,r.d=1367130551,s===Math.floor(s)?(r.a=s/4294967296|0,r.b=s|0):c+=s;for(var h=0;h<c.length+20;h++)r.b^=c.charCodeAt(h)|0,r.next()}function l(s,r){return r.a=s.a,r.b=s.b,r.c=s.c,r.d=s.d,r}function d(s,r){var c=new n(s),h=r&&r.state,a=function(){return(c.next()>>>0)/4294967296};return a.double=function(){do var o=c.next()>>>11,f=(c.next()>>>0)/4294967296,y=(o+f)/(1<<21);while(y===0);return y},a.int32=c.next,a.quick=a,h&&(typeof h=="object"&&l(h,c),a.state=function(){return l(c,{})}),a}t&&t.exports?t.exports=d:i&&i.amd?i(function(){return d}):this.tychei=d})(Me,typeof ee=="object"&&ee,typeof define=="function"&&define)});var Ae=C(()=>{});var De=C((ke,X)=>{(function(e,t,i){var n=256,l=6,d=52,s="random",r=i.pow(n,l),c=i.pow(2,d),h=c*2,a=n-1,o;function f(u,p,x){var g=[];p=p==!0?{entropy:!0}:p||{};var w=E(N(p.entropy?[u,m(t)]:u??_(),3),g),S=new y(g),v=function(){for(var b=S.g(l),O=r,P=0;b<c;)b=(b+P)*n,O*=n,P=S.g(1);for(;b>=h;)b/=2,O/=2,P>>>=1;return(b+P)/O};return v.int32=function(){return S.g(4)|0},v.quick=function(){return S.g(4)/4294967296},v.double=v,E(m(S.S),t),(p.pass||x||function(b,O,P,G){return G&&(G.S&&I(G,S),b.state=function(){return I(S,{})}),P?(i[s]=b,O):b})(v,w,"global"in p?p.global:this==i,p.state)}function y(u){var p,x=u.length,g=this,w=0,S=g.i=g.j=0,v=g.S=[];for(x||(u=[x++]);w<n;)v[w]=w++;for(w=0;w<n;w++)v[w]=v[S=a&S+u[w%x]+(p=v[w])],v[S]=p;(g.g=function(b){for(var O,P=0,G=g.i,U=g.j,L=g.S;b--;)O=L[G=a&G+1],P=P*n+L[a&(L[G]=L[U=a&U+O])+(L[U]=O)];return g.i=G,g.j=U,P})(n)}function I(u,p){return p.i=u.i,p.j=u.j,p.S=u.S.slice(),p}function N(u,p){var x=[],g=typeof u,w;if(p&&g=="object")for(w in u)try{x.push(N(u[w],p-1))}catch(S){}return x.length?x:g=="string"?u:u+"\0"}function E(u,p){for(var x=u+"",g,w=0;w<x.length;)p[a&w]=a&(g^=p[a&w]*19)+x.charCodeAt(w++);return m(p)}function _(){try{var u;return o&&(u=o.randomBytes)?u=u(n):(u=new Uint8Array(n),(e.crypto||e.msCrypto).getRandomValues(u)),m(u)}catch(g){var p=e.navigator,x=p&&p.plugins;return[+new Date,e,x,e.screen,m(t)]}}function m(u){return String.fromCharCode.apply(0,u)}if(E(i.random(),t),typeof X=="object"&&X.exports){X.exports=f;try{o=Ae()}catch(u){}}else typeof define=="function"&&define.amd?define(function(){return f}):i["seed"+s]=f})(typeof self!="undefined"?self:ke,[],Math)});var Le=C((qt,qe)=>{var yt=Oe(),gt=Ne(),pt=_e(),xt=je(),wt=Ge(),St=Te(),D=De();D.alea=yt;D.xor128=gt;D.xorwow=pt;D.xorshift7=xt;D.xor4096=wt;D.tychei=St;qe.exports=D});var te=C(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.GameState=M.Difficulty=void 0;var bt;(function(e){e[e.Easy=.5]="Easy",e[e.Normal=1]="Normal",e[e.Hard=1.5]="Hard",e[e.Insane=3]="Insane",e[e.Impossible=2147483647]="Impossible"})(bt=M.Difficulty||(M.Difficulty={}));var vt;(function(e){e.MenuScreen="MenuScreen",e.GameScreen="GameScreen",e.Crashing="Dying",e.ScoreScreenTransition="ScoreScreenTransition",e.ScoreScreen="ScoreScreen"})(vt=M.GameState||(M.GameState={}))});var re=C(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.decodeReplay=q.encodeReplay=void 0;var He="\u200B",It=e=>[e.difficulty,e.seed,...e.clicks].join(He);q.encodeReplay=It;var Et=e=>{let[t,i,...n]=e.split(He);return{seed:i,difficulty:parseFloat(t),clicks:n.map(l=>parseInt(l))}};q.decodeReplay=Et});var We=C(T=>{"use strict";var ie=T&&T.__awaiter||function(e,t,i,n){function l(d){return d instanceof i?d:new i(function(s){s(d)})}return new(i||(i=Promise))(function(d,s){function r(a){try{h(n.next(a))}catch(o){s(o)}}function c(a){try{h(n.throw(a))}catch(o){s(o)}}function h(a){a.done?d(a.value):l(a.value).then(r,c)}h((n=n.apply(e,t||[])).next())})},Ft=T&&T.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(T,"__esModule",{value:!0});T.game=void 0;var Ue=Ft(Le()),F=te(),Ot=re(),Pt=(e,t,i,n,l)=>(e-t)*(l-n)/(i-t)+n,Nt=(e,t)=>({time:0,reset(){this.time=0},update(i,n){this.time+=i*1e3,this.time>=e&&(t(n),this.time=0)}}),ne=60,se=1e3/ne,Ve=15*ne,Bt=-5*ne,Xe=e=>{let t=[],i=[...e,e[0]];for(let n=0;n<i.length-1;n++){let l=i[n],d=i[n+1];t.push({x:d.x-l.x,y:d.y-l.y})}return t},$e=(e,t)=>{let i=Infinity,n=-Infinity;for(let l of t){let d=(l.x*e.x+l.y*e.y)/Math.sqrt(e.x*e.x+e.y*e.y);d>n&&(n=d),d<i&&(i=d)}return{min:i,max:n}},_t=(e,t,i,n)=>e<i?i-t:e-n;function ze(e,t){if(Array.isArray(e[0])){let r=e,c=t;for(let h of r)for(let a of c)if(ze(h,a))return!0;return!1}let i=e,n=t;if(i.length<3||n.length<3)throw new Error("Shapes must be a polygon (at least 3 vertices)");let l=Xe(i),d=Xe(n),s=[...l,...d];for(let r of s){let c=Math.sqrt(r.y*r.y+r.x*r.x),h={x:-r.y/c,y:r.x/c},{min:a,max:o}=$e(h,i),{min:f,max:y}=$e(h,n);if(_t(a,o,f,y)>0)return!1}return!0}var Ct=(e,t,i)=>(i=i*Math.PI/180,{x:e.x+(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i),y:e.y+(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)});function jt(e){var t;let{width:i,height:n,dimensions:l,difficulty:d,replay:s,headless:r,bestScore:c,onFinalScore:h,getNewSeed:a,bindHandleTap:o,onStateChange:f,drawInit:y,update:I,draw:N,drawScore:E}=e,_="",m=Ue.default(_),u=a.bind(e),x=(t={[F.Difficulty.Easy]:100,[F.Difficulty.Normal]:100,[F.Difficulty.Hard]:200,[F.Difficulty.Insane]:350,[F.Difficulty.Impossible]:1e3}[d])!==null&&t!==void 0?t:100;return{debug:!1,conf:{width:i,height:n},state:F.GameState.MenuScreen,score:0,bestScore:c,height:420,player:{x:0,y:0,rotation:0,velocity:0,width:l.playerWidth,height:l.playerHeight,getBoundingBoxes(){let g={x:this.x+this.width/2,y:this.y+this.height/2};return[[{x:this.x,y:this.y},{x:this.x+12,y:this.y},{x:this.x+34,y:this.y+12},{x:this.x+8,y:this.y+12}],[{x:this.x+4,y:this.y+12},{x:this.x+34,y:this.y+12},{x:this.x+34,y:this.y+18},{x:this.x+28,y:this.y+18},{x:this.x+28,y:this.y+20},{x:this.x,y:this.y+18},{x:this.x,y:this.y+14}],[{x:this.x+7,y:this.y+18},{x:this.x+20,y:this.y+18},{x:this.x+20,y:this.y+22},{x:this.x+7,y:this.y+24}]].map(w=>w.map(S=>Ct(g,S,this.rotation)))}},pipes:[],wasPassingThroughPipe:!1,ceilingOffset:0,backgroundOffset:0,numUpdatesSinceLastClick:0,replay:s??{seed:_,difficulty:d,clicks:[]},runningReplay:!!s,fetchingSeed:!1,replayIndex:0,drawParams:{},pipeSpawner:Nt(1400,g=>{let w=100,S=.35,v=w*S+w*(1-S)/d;g.push({x:n,y:Pt(m(),0,1,l.topPipeOffset,n-(l.bottomPipeOffset+v)),width:l.pipeWidth,height:v,passed:!1,getBoundingBoxVerts(){let b=[{x:this.x,y:this.y},{x:this.x+this.width,y:this.y},{x:this.x+this.width,y:this.y+this.height},{x:this.x,y:this.y+this.height}],O=[{x:this.x,y:0},{x:this.x+this.width,y:0},{x:this.x+this.width,y:this.y},{x:this.x,y:this.y}],P=[{x:this.x,y:this.y+this.height},{x:this.x+this.width,y:this.y+this.height},{x:this.x+this.width,y:2*n-this.y-this.height},{x:this.x,y:2*n-this.y-this.height}];return{upper:O,lower:P,space:b}}})}),reset(){var g;this.score=0,this.player.x=50,this.player.y=200,this.player.rotation=Math.PI/4,this.player.velocity=0,this.pipes=[],this.pipeSpawner.reset(),this.wasPassingThroughPipe=!1,this.numUpdatesSinceLastClick=0,this.replayIndex=0,m=Ue.default(_),this.runningReplay||(this.replay.seed=_,this.replay.clicks=[]),(g=E==null?void 0:E.bind(e))===null||g===void 0||g(this.score,this.bestScore,this.drawParams)},run(){var g,w,S,v,b;return ie(this,void 0,void 0,function*(){for(yield this.fetchSeed(),this.reset(),(g=o==null?void 0:o.bind(e))===null||g===void 0||g(()=>{this.handleTap(!0)}),this.drawParams=(S=(w=y==null?void 0:y.bind(e))===null||w===void 0?void 0:w())!==null&&S!==void 0?S:{};!r||this.state!==F.GameState.ScoreScreen;){let O=se/1e3;this.update(O),this.state===F.GameState.GameScreen&&this.pipeSpawner.update(O,this.pipes),(v=I==null?void 0:I.bind(e))===null||v===void 0||v(O,x),(b=N==null?void 0:N.bind(e))===null||b===void 0||b(this.drawParams,{player:this.player,pipes:this.pipes}),r||(this.runningReplay?yield new Promise(P=>setTimeout(P,se/3)):yield new Promise(P=>setTimeout(P,se)))}return this.score})},fetchSeed(g,w){return ie(this,void 0,void 0,function*(){return this.fetchingSeed=!0,u(g,w).then(S=>{_=S,this.fetchingSeed=!1})})},handleTap(g=!1){var w;if(!this.fetchingSeed){if(this.state===F.GameState.ScoreScreen)this.reset();else if(g&&this.runningReplay)return;if([F.GameState.MenuScreen,F.GameState.ScoreScreen].includes(this.state)){let S=this.state;this.state=F.GameState.GameScreen,(w=f==null?void 0:f.bind(e))===null||w===void 0||w(S,this.state)}this.state===F.GameState.GameScreen&&(this.runningReplay||(this.replay.clicks.push(this.numUpdatesSinceLastClick),this.jump()),this.numUpdatesSinceLastClick=0)}},gameOver(g){var w;return ie(this,void 0,void 0,function*(){if(!this.runningReplay&&(!g||g&&this.state!==F.GameState.Crashing)&&(this.score>this.bestScore&&(this.bestScore=this.score),(w=E==null?void 0:E.bind(e))===null||w===void 0||w(this.score,this.bestScore,this.drawParams),this.fetchSeed(this.score,Ot.encodeReplay(this.replay))),g){let S=this.state;this.state=F.GameState.ScoreScreenTransition,f&&(yield f.bind(e)(S,this.state));let v=()=>{let b=this.state;this.state=F.GameState.ScoreScreen,f&&f.bind(e)(b,this.state)};h==null||h(this.score),r?v():setTimeout(v,500)}else{let S=this.state;this.state=F.GameState.Crashing,f&&f.bind(e)(S,this.state),this.player.velocity>0&&this.jump(.5)}})},jump(g=1){this.player.velocity=Bt*g},update(g){if(this.runningReplay&&this.numUpdatesSinceLastClick===this.replay.clicks[this.replayIndex]&&(this.replayIndex+=1,this.handleTap(),this.jump()),[F.GameState.GameScreen,F.GameState.Crashing].includes(this.state)){this.player.velocity+=Ve*g,this.player.y+=this.player.velocity*g,this.player.rotation=Math.min(this.player.velocity/Ve*90,90);let w=this.conf.height-l.playerHeight-l.barrierHeight;this.player.y>=w?(this.player.velocity=0,this.player.y=w,this.gameOver(!0)):this.player.y<=l.barrierHeight&&(this.player.y=l.barrierHeight)}if(this.state===F.GameState.GameScreen){let w=this.player.getBoundingBoxes(),S=!1,v=!1;this.pipes=this.pipes.filter(b=>{var O;b.x-=x*g;let P=b.getBoundingBoxVerts();return ze(w,[P.upper,P.lower])?v=!0:!b.passed&&this.player.x>b.x+b.width+10&&(this.score+=1,(O=E==null?void 0:E.bind(e))===null||O===void 0||O(this.score,this.bestScore,this.drawParams),b.passed=!0),b.x>-b.width}),v&&this.gameOver(),this.wasPassingThroughPipe=S}this.state===F.GameState.GameScreen&&(this.numUpdatesSinceLastClick+=1)}}}T.game=jt});var oe=V(Ee()),Ke=V(We()),j=V(te()),Qe=V(re());var A={firstName:window.localStorage.getItem("firstName")??"",lastName:window.localStorage.getItem("lastName")??"",email:window.localStorage.getItem("email")??""},Ye=()=>!!A.firstName&&!!A.lastName&&!!A.email,ae=()=>A,Je=e=>{A=e,window.localStorage.setItem("firstName",A.firstName),window.localStorage.setItem("lastName",A.lastName),window.localStorage.setItem("email",A.email)};var Ze=e=>{let t=oe.default.parse(window.location.search);if(!Object.keys(j.Difficulty).includes(t.d?.toString()??""))throw window.location.search="?d=Normal",t=oe.default.parse(window.location.search),new Error;let i=t.replay?.toString(),n;if(i){n=Qe.decodeReplay(i);let m=document.getElementById("difficultyNav");m&&(m.style.display="none")}let l=t.d?.toString()??"Normal",d=Object.keys(j.Difficulty).includes(l)?j.Difficulty[l]:j.Difficulty.Normal,s={width:window.innerWidth,height:420};document.getElementById("flyZone")?.setAttribute("style","height:"+s.height+"px"),document.getElementsByTagName("canvas")[0].width=s.width,document.getElementsByTagName("canvas")[0].height=s.height;class r{constructor(u,p,x,g,w,S){this.currentFrameFloat=0;this.currentFrame=0;this.isReset=!0;this.image=new Image(p,x),this.image.src=u,this.speed=S,this.cols=g,this.rows=w,this.numFrames=g*w,this.width=this.image.width/this.cols,this.height=this.image.height/this.rows}reset(){this.isReset||this.update(this.numFrames)}update(u){this.isReset=!1,this.currentFrameFloat+=this.speed*u,this.currentFrameFloat>=this.numFrames&&(this.currentFrameFloat=0,this.isReset=!0),this.currentFrame=Math.floor(this.currentFrameFloat)}draw(u,p,x,g){let w=this.currentFrame%this.cols*this.image.width,S=Math.floor(this.currentFrame/this.rows*this.image.height);u.translate(p+this.width/2,x+this.height/2),u.rotate(g*Math.PI/180),u.drawImage(this.image,w,S+1,this.width,this.height-2,-this.width/2,-this.height/2,this.width,this.height),u.setTransform(1,0,0,1,0,0)}}let c=(m,u,p="red",x="hsla(0, 100%, 60%, 0.5)")=>{let g=[...u,u[0]],w=m.fillStyle,S=m.strokeStyle;m.fillStyle=x,m.strokeStyle=p,m.beginPath(),m.moveTo(u[0].x,u[0].y);for(let v of g)m.lineTo(v.x,v.y);m.stroke(),m.fill(),m.fillStyle=w,m.strokeStyle=S},h=new r("assets/player.png",34,96,1,4,15),a=new Image(52,1);a.src="assets/pipe.png";let o=new Image(52,26);o.src="assets/pipe-up.png";let f=new Image(52,26);f.src="assets/pipe-down.png";let y=new Image(64,16);y.src="assets/ceiling.png";let I=new Image(276,109);I.src="assets/sky.png";let N={};for(let m=0;m<20;m++){let u=m>=10?"big":"small",p=m>=10?m-10:m;N[u+p]=new Image(12,14),N[u+p].src=`assets/font_${u}_${p}.png`}let E=`best${d}`,_=parseInt(window.localStorage.getItem(E)??"")||0;Ke.game({...s,dimensions:{playerWidth:h.width,playerHeight:h.height,barrierHeight:y.height,topPipeOffset:y.height+2*f.height,bottomPipeOffset:y.height+2*o.height,pipeWidth:o.width},bestScore:_,difficulty:d,replay:n,extra:{debug:!1,ceilingOffset:0,backgroundOffset:0,state:j.GameState.MenuScreen,playerSprite:h,gameId:void 0},async getNewSeed(m,u){if(n)return n.seed;typeof m=="number"&&m>_&&(_=m,window.localStorage.setItem(E,_.toString()));let p={firstName:e.firstName,lastName:e.lastName,email:e.email,difficulty:d},x=typeof u=="string"&&typeof m=="number"&&this.extra.gameId;typeof u=="string"&&typeof m=="number"&&this.extra.gameId&&(p={...p,gameId:this.extra.gameId,replay:u,score:m});try{let g=await fetch("/api/seed",{method:x?"PATCH":"POST",body:JSON.stringify(p),headers:{"Content-Type":"application/json"}});if(!g.ok)throw new Error("Error fetching: "+g.statusText);let w=await g.json();return this.extra.gameId=w.gameId,w.seed}catch(g){return this.extra.gameId=void 0,console.error(g),alert("There was an error connecting to the server, please refresh and try again"),Math.random().toString(16).substr(2,8)}},bindHandleTap(m){let u=document.getElementById("sky");u&&(u.onmousedown=m,u.ontouchstart=p=>{p.preventDefault(),m()},u.ontouchend=p=>{p.preventDefault()}),document.onkeydown=p=>{switch(p.key){case" ":m();break;case"d":this.extra.debug=!this.extra.debug;break}}},async onStateChange(m,u){this.extra.state=u,m===j.GameState.MenuScreen&&u===j.GameState.GameScreen?(document?.getElementById("menuScreen")?.classList.remove("animate__fadeIn"),document?.getElementById("menuScreen")?.classList.add("animate__fadeOut"),document?.getElementById("gameScore")?.classList.remove("hide")):m===j.GameState.ScoreScreen&&u===j.GameState.GameScreen?(document?.getElementById("scoreScreen")?.classList.remove("animate__fadeIn"),document?.getElementById("scoreScreen")?.classList.add("animate__fadeOut"),document?.getElementById("gameScore")?.classList.remove("hide")):[j.GameState.Crashing,j.GameState.GameScreen].includes(m)&&u===j.GameState.ScoreScreenTransition&&await new Promise(p=>setTimeout(()=>{document.getElementById("gameScore")?.classList.add("hide"),document.getElementById("scoreScreen")?.classList.remove("animate__fadeOut"),document.getElementById("scoreScreen")?.classList.add("animate__fadeIn"),p()},250))},drawInit(){let u=document.getElementsByTagName("canvas")[0].getContext("2d");if(!u)throw new Error("\u{1F440} What are you doing?");return{ctx:u}},drawScore(m,u){let p=document.getElementById("gameScore"),x=document.getElementById("finalScore"),g=document.getElementById("bestScore");if(!p||!x||!g)return;let w=m.toString().split("").map(b=>N["big"+b].cloneNode()),S=m.toString().split("").map(b=>N["small"+b].cloneNode()),v=u.toString().split("").map(b=>N["small"+b].cloneNode());p.innerHTML="",p.append(...w),x.innerHTML="",x.append(...S),g.innerHTML="",g.append(...v)},update(m,u){this.extra.state===j.GameState.GameScreen?this.extra.playerSprite.update(m):this.extra.playerSprite.reset(),this.extra.state===j.GameState.GameScreen&&(this.extra.ceilingOffset-=u*m,Math.abs(this.extra.ceilingOffset)>y.width&&(this.extra.ceilingOffset=0),this.extra.backgroundOffset-=u/2*m,Math.abs(this.extra.backgroundOffset)>I.width&&(this.extra.backgroundOffset=0))},draw({ctx:m},{player:u,pipes:p}){m.clearRect(0,0,s.width,s.height);for(let x=0,g=0;x<s.width+I.width;x+=I.width)m.drawImage(I,x+this.extra.backgroundOffset-g*2,s.height-I.height),g++;this.extra.playerSprite.draw(m,u.x,u.y,u.rotation),this.extra.debug&&(m.lineWidth=2,m.strokeStyle="red",m.lineJoin="round",u.getBoundingBoxes().forEach(g=>c(m,g)));for(let x of p)if(m.fillStyle="white",m.drawImage(a,x.x,0,x.width,x.y-f.height),m.drawImage(f,x.x-(f.width-a.width)/2,x.y-f.height),m.drawImage(a,x.x,x.y+x.height+o.height,x.width,s.height-x.y-x.height),m.drawImage(o,x.x-(o.width-a.width)/2,x.y+x.height),this.extra.debug){let g=x.getBoundingBoxVerts();c(m,g.upper),c(m,g.lower),c(m,g.space,"green","hsla(80, 100%, 60%, 0.5)")}for(let x=0;x<s.width+y.width;x+=y.width)m.drawImage(y,x+this.extra.ceilingOffset,0),m.drawImage(y,x+this.extra.ceilingOffset,s.height-y.height)}}).run()},$=document.getElementById("sky"),H=document.getElementById("playerInfo");$&&H&&(Ye()?(H.style.display="none",$.style.display="flex",Ze(ae())):(H.style.display="block",$.style.display="none",H.onsubmit=e=>{e.preventDefault(),e.stopPropagation();let t=document.getElementById("playerInfoFirstName").value??"?",i=document.getElementById("playerInfoLastName").value??"?",n=document.getElementById("playerInfoEmail").value??"?";Je({firstName:t,lastName:i,email:n}),H.style.display="none",$.style.display="flex",Ze(ae())}));})();
